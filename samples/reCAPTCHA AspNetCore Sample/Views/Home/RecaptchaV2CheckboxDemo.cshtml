@using Finoaker.Web.Recaptcha
@model ContactViewModel
@addTagHelper *, Finoaker.Web.Recaptcha
@{
    ViewData["Title"] = "reCAPTCHA | V2 Checkbox Demo";
    var verifyResponse = ((VerifyResponse)ViewData["VerifyResponse"]);
}

@if (verifyResponse != null)
{
    <div class="mdc-dialog"
         role="alertdialog"
         aria-modal="true"
         aria-labelledby="my-dialog-title"
         aria-describedby="my-dialog-content">
        <div class="mdc-dialog__container">
            <div class="mdc-dialog__surface">
                <h2 class="mdc-dialog__title" id="my-dialog-title">Verification Result</h2>
                <div class="mdc-dialog__content" id="my-dialog-content">
                    <p>@(verifyResponse.Success ? $"Congratulations '{ViewData["Name"]}', you are NOT a robot!" : $"Aha! You've been caught out '{ViewData["Name"]}', you ARE a robot!")</p>
                </div>
                <footer class="mdc-dialog__actions">
                    <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="yes">
                        <span class="mdc-button__label">@(verifyResponse.Success ? "Cool" : "DAMN you reCAPTCHA!")</span>
                    </button>
                </footer>
            </div>
        </div>
        <div class="mdc-dialog__scrim"></div>
    </div>
}

<div class="mdc-layout-grid" style="width:100%;max-width:1200px">
    <div class="mdc-layout-grid__inner" style="text-align:center">
        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12" style="display:inline-block">
            <h3 class="mdc-typography--headline3">reCAPTCHA v2 Checkbox</h3>
            <img class="mdc-image-list__image" src="~/images/newCaptchaAnchor.gif" style="max-width:600px;">
            <p>
                This sample demos a reCAPTCHA v2 Checkbox verification using a common "Contact us" form. reCAPTCHA is a free service that protects your site from spam and abuse. It uses advanced risk analysis techniques to tell humans and bots apart.
            </p>
        </div>
        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12" style="text-align:left">
            <div class="mdc-tab-bar" role="tablist">
                <div class="mdc-tab-scroller">
                    <div class="mdc-tab-scroller__scroll-area">
                        <div class="mdc-tab-scroller__scroll-content">
                            <button class="mdc-tab mdc-tab--active" role="tab" aria-selected="true" tabindex="0">
                                <span class="mdc-tab__content">
                                    <span class="mdc-tab__icon material-icons" aria-hidden="true">code</span>
                                    <span class="mdc-tab__text-label">Setup</span>
                                </span>
                                <span class="mdc-tab-indicator mdc-tab-indicator--active">
                                    <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
                                </span>
                                <span class="mdc-tab__ripple"></span>
                            </button>
                            <button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
                                <span class="mdc-tab__content">
                                    <span class="mdc-tab__icon material-icons" aria-hidden="true">computer</span>
                                    <span class="mdc-tab__text-label">Demo</span>
                                </span>
                                <span class="mdc-tab-indicator">
                                    <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
                                </span>
                                <span class="mdc-tab__ripple"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-container">
                <div class="tab-content tab-content--active">
                    <div>
                        <span>Setting up the Finoaker reCAPTCHA for ASP.NET follows standard MVC pattern:</span>
                        <ul>
                            <li>Add the keys to settings file. Get keys from <a href="https://www.google.com/recaptcha/admin" target="_blank">reCAPTCHA admin console.</a></li>
                            <li>Add the reCAPTCHA service to the apps ServiceCollection in the Startup class.</li>
                            <li>Add a property to the model to store response token from the client.</li>
                            <li>Add the reCAPTCHA TagHelper <b>OR</b> HtmlHelper to the form in your View and bind to model property.</li>
                            <li>Verify the reCAPTCHA response in the Controller.</li>
                        </ul>
                    </div>

                    <h3 class="mdc-typography--headline4">Settings</h3>
                    <div>Add reCAPTCHA keys to the appSettings.json file (could also use UserSecrets)</div>
                    <pre style="font-family:Consolas;font-size:13px;color:black;">{
&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;RecaptchaSettings&quot;</span>:&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;Keys&quot;</span>:&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;SecretKey&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;[v3-secret-key]&quot;</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;SiteKey&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;[v3-site-key]I&quot;</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;KeyType&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;V3&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;SecretKey&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;[v2-secret-key]&quot;</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;SiteKey&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;[v2-site-key]&quot;</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2e75b6;">&quot;KeyType&quot;</span>:&nbsp;<span style="color:#a31515;">&quot;V2Checkbox&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;]
&nbsp;&nbsp;}
}
</pre>
                    <h3 class="mdc-typography--headline4">Startup</h3>
                    <div>In the apps <code>Startup</code> class, add the reCAPTCHA settings to the service collection, in the <code>ConfigureServices(IServiceCollection services)</code> method. Pass in the RecaptchaSettings section.</div>
                    <pre style="font-family:Consolas;font-size:13px;color:black;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:#74531f;">ConfigureServices</span>(<span style="color:#2b91af;">IServiceCollection</span>&nbsp;<span style="color:#1f377f;">services</span>)
{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Add&nbsp;reCAPTCHA&nbsp;settings.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:yellow;"><span style="color:#1f377f;">services</span>.<span style="color:#74531f;">Configure</span>&lt;<span style="color:#2b91af;">RecaptchaSettings</span>&gt;(Configuration.<span style="color:#74531f;">GetSection</span>(<span style="color:blue;">nameof</span>(<span style="color:#2b91af;">RecaptchaSettings</span>)));</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#1f377f;">services</span>.<span style="color:#74531f;">AddMvc</span>().<span style="color:#74531f;">SetCompatibilityVersion</span>(<span style="color:#2b91af;">CompatibilityVersion</span>.Version_2_2);
}</pre>
                    <h3 class="mdc-typography--headline4">Model</h3>
                    <div>Add a new property to your model to hold the reCAPTCHA response, so it can be posted back for verification.</div>
                    <pre style="font-family:Consolas;font-size:13px;color:black;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">SampleModel</span>
{
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DisplayName</span>(<span style="color:#a31515;">&quot;Name&nbsp;(required)&quot;</span>),&nbsp;<span style="color:#2b91af;">Required</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;Name&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DisplayName</span>(<span style="color:#a31515;">&quot;Email&nbsp;(required)&quot;</span>),&nbsp;<span style="color:#2b91af;">Required</span>,&nbsp;<span style="color:#2b91af;">EmailAddress</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;Email&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DisplayName</span>(<span style="color:#a31515;">&quot;Phone&quot;</span>),&nbsp;<span style="color:#2b91af;">Phone</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;Phone&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DisplayName</span>(<span style="color:#a31515;">&quot;Message&nbsp;(required)&quot;</span>),&nbsp;<span style="color:#2b91af;">Required</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;Message&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:yellow">[<span style="color:#2b91af;">Required</span>]</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:yellow"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">string</span>&nbsp;RecaptchaResponse&nbsp;{&nbsp;<span style="color:blue;">get</span>;&nbsp;<span style="color:blue;">set</span>;&nbsp;}</span>
}
</pre>
                    <h3 class="mdc-typography--headline4">View | Render</h3>
                    <div>Add your model and TagHelper reference (if using the TagHelper instead of HtmlHelper) to the top of your page and then drop the Finoaker reCAPTCHA TagHelper OR HtmlHelper to your form. Use the property you added to the model, to store the challenge response.</div>
                    <pre style="font-family:Consolas;font-size:13px;color:black;"><span style="background:yellow;">@@</span><span style="color:blue;">using</span>&nbsp;Finoaker.Web.Recaptcha
<span style="background:yellow;">@@</span><span style="color:blue;">using</span>&nbsp;Microsoft.Extensions.Options
<span style="background:yellow;">@@</span><span style="color:blue;">using</span>&nbsp;SampleCode
<span style="background:yellow;">@@model</span>&nbsp;<span style="color:#2b91af;">SampleModel</span>
<span style="background:yellow;">@@addTagHelper</span>&nbsp;<span style="color:#a31515;">*,&nbsp;Finoaker.Web.Recaptcha</span>
<span style="background:yellow;">@@{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;AspNetCore&nbsp;retrieve&nbsp;settings&nbsp;from&nbsp;the&nbsp;ServiceCollection.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;<span style="color:#1f377f;">settings</span>&nbsp;=&nbsp;((<span style="color:#2b91af;">IOptions</span>&lt;<span style="color:#2b91af;">RecaptchaSettings</span>&gt;)ViewContext.HttpContext.RequestServices.<span style="color:#74531f;">GetService</span>(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">IOptions</span>&lt;<span style="color:#2b91af;">RecaptchaSettings</span>&gt;))).Value;
<span style="background:yellow;">}</span>
 
<span style="color:blue;">&lt;</span><span style="color:maroon;">!DOCTYPE</span>&nbsp;<span style="color:red;">html</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;</span><span style="color:maroon;">html</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;</span><span style="color:maroon;">head</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">meta</span>&nbsp;<span style="color:red;">name</span><span style="color:blue;">=</span><span style="color:blue;">&quot;viewport&quot;</span>&nbsp;<span style="color:red;">content</span><span style="color:blue;">=</span><span style="color:blue;">&quot;width=device-width&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">title</span><span style="color:blue;">&gt;</span>Recaptcha&nbsp;Demo<span style="color:blue;">&lt;/</span><span style="color:maroon;">title</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;/</span><span style="color:maroon;">head</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;</span><span style="color:maroon;">body</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">h1</span><span style="color:blue;">&gt;</span>Contact&nbsp;Us<span style="color:blue;">&lt;/</span><span style="color:maroon;">h1</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">form</span>&nbsp;<span style="color:red;">asp-controller</span><span style="color:blue;">=</span><span style="color:blue;">&quot;SampleV2&quot;</span>&nbsp;<span style="color:red;">asp-action</span><span style="color:blue;">=</span><span style="color:blue;">&quot;RecaptchaV2CheckboxDemo&quot;</span>&nbsp;<span style="color:red;">method</span><span style="color:blue;">=</span><span style="color:blue;">&quot;post&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background:yellow;">@@</span>Html.<span style="color:#74531f;">AntiForgeryToken</span>()
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">div</span>&nbsp;<span style="color:red;">class</span><span style="color:blue;">=</span><span style="color:blue;">&quot;form-field-container&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">label</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Name&quot;</span><span style="color:blue;">&gt;&lt;/</span><span style="color:maroon;">label</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">input</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Name&quot;</span>&nbsp;<span style="color:red;">type</span><span style="color:blue;">=</span><span style="color:blue;">&quot;text&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">div</span><span style="color:blue;">&gt;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">div</span>&nbsp;<span style="color:red;">class</span><span style="color:blue;">=</span><span style="color:blue;">&quot;form-field-container&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">label</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Email&quot;</span><span style="color:blue;">&gt;&lt;/</span><span style="color:maroon;">label</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">input</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Email&quot;</span>&nbsp;<span style="color:red;">type</span><span style="color:blue;">=</span><span style="color:blue;">&quot;email&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">div</span><span style="color:blue;">&gt;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">div</span>&nbsp;<span style="color:red;">class</span><span style="color:blue;">=</span><span style="color:blue;">&quot;form-field-container&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">label</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Phone&quot;</span><span style="color:blue;">&gt;&lt;/</span><span style="color:maroon;">label</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">input</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Phone&quot;</span>&nbsp;<span style="color:red;">type</span><span style="color:blue;">=</span><span style="color:blue;">&quot;tel&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">div</span><span style="color:blue;">&gt;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">div</span>&nbsp;<span style="color:red;">class</span><span style="color:blue;">=</span><span style="color:blue;">&quot;form-field-container&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">label</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Message&quot;</span><span style="color:blue;">&gt;&lt;/</span><span style="color:maroon;">label</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">input</span>&nbsp;<span style="color:red;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;Message&quot;</span>&nbsp;<span style="color:red;">type</span><span style="color:blue;">=</span><span style="color:blue;">&quot;tel&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">div</span><span style="color:blue;">&gt;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkgreen;">&lt;!--&nbsp;Use&nbsp;either&nbsp;the&nbsp;TagHelper&nbsp;reCAPTCHA&nbsp;version...&nbsp;--&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="font-weight:bold;color:purple;">recaptcha-v2-checkbox</span>&nbsp;<span style="font-weight:bold;color:purple;">asp-for</span><span style="color:blue;">=</span><span style="color:blue;">&quot;</span>RecaptchaResponse<span style="color:blue;">&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkgreen;">&lt;!--&nbsp;...OR&nbsp;the&nbsp;HtmlHelper&nbsp;reCAPTCHA&nbsp;version&nbsp;--&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background:yellow;">@@</span>Html.<span style="color:#74531f;">RecaptchaV2CheckboxFor</span>(<span style="color:#1f377f;">m</span>&nbsp;=&gt;&nbsp;<span style="color:#1f377f;">m</span>.RecaptchaResponse,&nbsp;<span style="color:#1f377f;">siteKey</span>:&nbsp;<span style="color:#1f377f;">settings</span>.<span style="color:#74531f;">First</span>(<span style="color:#2b91af;">RecaptchaType</span>.V2Checkbox)?.SiteKey)
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">div</span>&nbsp;<span style="color:red;">class</span><span style="color:blue;">=</span><span style="color:blue;">&quot;form-field-container&quot;</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;</span><span style="color:maroon;">input</span>&nbsp;<span style="color:red;">type</span><span style="color:blue;">=</span><span style="color:blue;">&quot;submit&quot;</span>&nbsp;<span style="color:blue;">/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">div</span><span style="color:blue;">&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">&lt;/</span><span style="color:maroon;">form</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;/</span><span style="color:maroon;">body</span><span style="color:blue;">&gt;</span>
<span style="color:blue;">&lt;/</span><span style="color:maroon;">html</span><span style="color:blue;">&gt;</span></pre>
                    <h3 class="mdc-typography--headline4">Controller | Verify</h3>
                    <div>In your controller action, add the Model and Recaptcha services as parameters. Check model state as normal, then call the verification service. Check the results for verifcation success.</div>
                    <pre style="font-family:Consolas;font-size:13px;color:black;"><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">SampleV2Controller</span>&nbsp;:&nbsp;<span style="color:#2b91af;">Controller</span>
{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;<span style="color:#2b91af;">RecaptchaSettings</span>&nbsp;_settings;
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">SampleV2Controller</span>(<span style="color:#2b91af;">IOptions</span>&lt;<span style="color:#2b91af;">RecaptchaSettings</span>&gt;&nbsp;<span style="color:#1f377f;">settings</span>)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_settings&nbsp;=&nbsp;<span style="color:#1f377f;">settings</span>.Value;
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">HttpGet</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">IActionResult</span>&nbsp;<span style="color:#74531f;">RecaptchaV2CheckboxDemo</span>()
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8f08c4;">return</span>&nbsp;<span style="color:#74531f;">View</span>();
&nbsp;&nbsp;&nbsp;&nbsp;}
 
&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">HttpPost</span>,&nbsp;<span style="color:#2b91af;">ValidateAntiForgeryToken</span>]
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:#2b91af;">IActionResult</span>&nbsp;<span style="color:#74531f;">RecaptchaV2CheckboxDemo</span>(<span style="color:#2b91af;">SampleModel</span>&nbsp;<span style="color:#1f377f;">model</span>)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;check&nbsp;model&nbsp;state&nbsp;first&nbsp;to&nbsp;confirm&nbsp;all&nbsp;properties,&nbsp;including&nbsp;reCAPTCHA,&nbsp;are&nbsp;valid.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8f08c4;">if</span>&nbsp;(ModelState.IsValid)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;verify&nbsp;the&nbsp;reCAPCTHA&nbsp;response&nbsp;against&nbsp;verification&nbsp;service</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:yellow;"><span style="color:blue;">var</span>&nbsp;<span style="color:#1f377f;">verifyResult</span>&nbsp;=&nbsp;<span style="color:#2b91af;">RecaptchaService</span>.<span style="color:#74531f;">VerifyTokenAsync</span>(<span style="color:#1f377f;">model</span>.RecaptchaResponse,&nbsp;<span style="color:#2b91af;">RecaptchaType</span>.V2Checkbox,&nbsp;_settings).Result;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;check&nbsp;success&nbsp;status&nbsp;and&nbsp;score&nbsp;exceeds&nbsp;you&nbsp;minimum.</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8f08c4;">if</span>&nbsp;(<span style="color:#1f377f;">verifyResult</span>.Success)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Success</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//...</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color:#8f08c4;">else</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Fail</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//...</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8f08c4;">return</span>&nbsp;<span style="color:#74531f;">View</span>();
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre>
                </div>
                <div class="tab-content">
                    <div>
                        <div class="form-container">
                            <h2>Contact us</h2>
                            <form asp-controller="Home" asp-action="RecaptchaV2CheckboxDemo" method="post">
                                @Html.AntiForgeryToken()
                                <div class="field-container">
                                    <div class="mdc-text-field mdc-text-field--outlined form-field">
                                        <input asp-for="Name" class="mdc-text-field__input">
                                        <div class="mdc-notched-outline">
                                            <div class="mdc-notched-outline__leading"></div>
                                            <div class="mdc-notched-outline__notch">
                                                <label asp-for="Name" class="mdc-floating-label"></label>
                                            </div>
                                            <div class="mdc-notched-outline__trailing"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field-container">
                                    <div class="mdc-text-field mdc-text-field--outlined" style="width: 100%;">
                                        <input asp-for="Email" class="mdc-text-field__input">
                                        <div class="mdc-notched-outline">
                                            <div class="mdc-notched-outline__leading"></div>
                                            <div class="mdc-notched-outline__notch">
                                                <label asp-for="Email" class="mdc-floating-label"></label>
                                            </div>
                                            <div class="mdc-notched-outline__trailing"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field-container">
                                    <div class="mdc-text-field mdc-text-field--outlined" style="width: 100%;">
                                        <input asp-for="Phone" class="mdc-text-field__input">
                                        <div class="mdc-notched-outline">
                                            <div class="mdc-notched-outline__leading"></div>
                                            <div class="mdc-notched-outline__notch">
                                                <label asp-for="Phone" class="mdc-floating-label"></label>
                                            </div>
                                            <div class="mdc-notched-outline__trailing"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field-container">
                                    <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--fullwidth">
                                        <textarea asp-for="Message" class="mdc-text-field__input" rows="5"></textarea>
                                        <div class="mdc-notched-outline">
                                            <div class="mdc-notched-outline__leading"></div>
                                            <div class="mdc-notched-outline__notch">
                                                <label asp-for="Message" class="mdc-floating-label"></label>
                                            </div>
                                            <div class="mdc-notched-outline__trailing"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field-container">
                                    <recaptcha-v2-checkbox asp-for="RecaptchaResponse" callback="onSuccess" />
                                </div>
                                <div class="field-container">
                                    <input disabled
                                           type="submit"
                                           class="mdc-button mdc-button--raised"
                                           value="Send"
                                           id="submit-button" />
                                </div>
                            </form>
                            <div class="field-container">
                                <label for="basic-switch">reCAPTCHA Token&nbsp;&nbsp;</label>
                                <div class="mdc-switch">
                                    <div class="mdc-switch__track"></div>
                                    <div class="mdc-switch__thumb-underlay">
                                        <div class="mdc-switch__thumb">
                                            <input type="checkbox" id="basic-switch" class="mdc-switch__native-control" role="switch">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="token-container">
                                <div class="field-container">
                                    <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--fullwidth">
                                        <textarea class="mdc-text-field__input" rows="4" id="token-text" disabled></textarea>
                                        <div class="mdc-notched-outline">
                                            <div class="mdc-notched-outline__leading"></div>
                                            <div class="mdc-notched-outline__notch"></div>
                                            <div class="mdc-notched-outline__trailing"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Head {
    <link rel="stylesheet" href="~/css/site.css">
}

@section Scripts {
    <script src="~/js/site.js" type="text/javascript"></script>
    <script>
        const tabBar = new mdc.tabBar.MDCTabBar(document.querySelector('.mdc-tab-bar'));
        const tokenContainer = document.querySelector('.token-container');

        const dialogContainer = document.querySelector('.mdc-dialog');
        if (dialogContainer) {
            const dialog = new mdc.dialog.MDCDialog(dialogContainer);
            dialog.open();
        }

        const switchControl = new mdc.switchControl.MDCSwitch(document.querySelector('.mdc-switch'));
        switchControl.disabled = true;
        document.getElementById('basic-switch').addEventListener('change', function (e) {
            e.preventDefault();
            toggleTokenContainer(tokenContainer);
        });

        document.querySelectorAll('.mdc-text-field').forEach(el => mdc.textField.MDCTextField.attachTo(el));

        tabBar.listen('MDCTabBar:activated', function (e) {
            tabActivation(e, document.querySelectorAll('.tab-content'));
        });

        function onSuccess(token) {
            responseSuccess(
                token,
                document.getElementById('submit-button'),
                document.getElementById('token-text'),
                switchControl);
        }
    </script>
}